{% extends "layout.html" %}

{% block content %}
<div class="card-header">
    <h1>Invoices for {{ client[1] }}</h1>
    <a href="{{ url_for('clients') }}" class="btn btn-secondary">Back to Clients</a>
</div>

<div class="card" style="margin-bottom: 20px;">
    <form action="{{ url_for('client_invoices', client_id=client[0]) }}" method="GET"
        style="display: flex; align-items: center; gap: 15px;">
        <label for="status">Filter by Status:</label>
        <select name="status" id="status" onchange="this.form.submit()"
            style="padding: 8px; border-radius: 4px; border: 1px solid #ddd;">
            {% for status in statuses %}
            <option value="{{ status }}" {% if current_status==status %}selected{% endif %}>{{ status }}</option>
            {% endfor %}
        </select>
        <noscript>
            <button type="submit" class="btn btn-sm btn-primary">Filter</button>
        </noscript>
    </form>
</div>

<div class="card">
    <table>
        <thead>
            <tr>
                <th>Invoice #</th>
                <th>Date</th>
                <th>Status</th>
                <th>Amount</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for inv in invoices %}
            <tr>
                <td>{{ inv[1] }}</td>
                <td>{{ inv[3] }}</td>
                <td>
                    <form action="{{ url_for('update_status', invoice_number=inv[1]) }}" method="POST"
                        style="display:inline;">
                        <select name="status" onchange="this.form.submit()" class="status-badge status-{{ inv[4] }}">
                            <option value="Draft" {% if inv[4]=='Draft' %}selected{% endif %}>Draft</option>
                            <option value="Sent" {% if inv[4]=='Sent' %}selected{% endif %}>Sent</option>
                            <option value="Paid" {% if inv[4]=='Paid' %}selected{% endif %}>Paid</option>
                            <option value="Overdue" {% if inv[4]=='Overdue' %}selected{% endif %}>Overdue</option>
                        </select>
                    </form>
                </td>
                <td>${{ "%.2f"|format(inv[5]) }}</td>
                <td>
                    <a href="{{ url_for('download_pdf', invoice_number=inv[1]) }}"
                        class="btn btn-sm btn-secondary">PDF</a>
                    <a href="{{ url_for('edit_invoice', invoice_id=inv[0]) }}" class="btn btn-sm btn-secondary">Edit</a>
                    <a href="{{ url_for('delete_invoice', invoice_id=inv[0]) }}" class="btn btn-sm btn-primary"
                        style="background-color: #ef4444;" onclick="return confirm('Are you sure?')">Delete</a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5" style="text-align: center;">No invoices found for this status.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}